<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Browser Compatibility Test - Leon Portfolio</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #006b3f;
        }

        .header h1 {
            color: #006b3f;
            margin: 0 0 10px 0;
        }

        .header p {
            color: #666;
            margin: 0;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .test-section h2 {
            color: #006b3f;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .test-card {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #006b3f;
        }

        .test-card h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .test-result {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }

        .status-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-pass {
            background: #28a745;
        }

        .status-fail {
            background: #dc3545;
        }

        .status-warning {
            background: #ffc107;
        }

        .browser-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .browser-info h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
        }

        .info-label {
            font-weight: 600;
        }

        .score-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #006b3f, #10CF74);
            color: white;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .score-number {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #006b3f;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .error-list {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .error-item {
            color: #c53030;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #fed7d7;
        }

        .error-item:last-child {
            border-bottom: none;
        }

        .run-test-btn {
            background: #006b3f;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background 0.3s ease;
        }

        .run-test-btn:hover {
            background: #005530;
        }

        .run-test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .score-number {
                font-size: 36px;
            }
        }
    </style>
</head>

<body>
    <div class="test-container">
        <div class="header">
            <h1>Cross-Browser Compatibility Test</h1>
            <p>Testing Leon Portfolio vanilla implementation across different browsers and devices</p>
            <button id="runTestBtn" class="run-test-btn">Run Tests</button>
            <button id="runMainSiteBtn" class="run-test-btn">Test Main Site</button>
        </div>

        <div id="loadingIndicator" class="loading" style="display: none;">
            Running compatibility tests...
        </div>

        <div id="testResults" style="display: none;">
            <!-- Results will be populated here -->
        </div>
    </div>

    <script>
        class CrossBrowserTestUI {
            constructor() {
                this.testResults = null;
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('runTestBtn').addEventListener('click', () => {
                    this.runStandaloneTests();
                });

                document.getElementById('runMainSiteBtn').addEventListener('click', () => {
                    this.testMainSite();
                });
            }

            runStandaloneTests() {
                this.showLoading();

                // Simulate loading main site resources
                this.loadMainSiteResources().then(() => {
                    // Run the cross-browser validator
                    const validator = new CrossBrowserValidator();

                    // Wait for async tests to complete
                    setTimeout(() => {
                        this.displayResults(window.crossBrowserReport);
                    }, 2000);
                }).catch(error => {
                    this.showError('Failed to load main site resources: ' + error.message);
                });
            }

            testMainSite() {
                // Open main site in new window for testing
                const mainSiteWindow = window.open('../index.html', '_blank');

                if (mainSiteWindow) {
                    alert('Main site opened in new window. Check browser console for test results after page loads.');
                } else {
                    alert('Please allow popups and try again, or manually navigate to ../index.html');
                }
            }

            loadMainSiteResources() {
                return new Promise((resolve, reject) => {
                    // Load CSS
                    const cssLink = document.createElement('link');
                    cssLink.rel = 'stylesheet';
                    cssLink.href = '../css/styles.css';
                    cssLink.onload = () => {
                        // Load JavaScript
                        const jsScript = document.createElement('script');
                        jsScript.src = '../js/main.js';
                        jsScript.onload = () => {
                            // Load cross-browser test script
                            const testScript = document.createElement('script');
                            testScript.src = './cross-browser-test.js';
                            testScript.onload = resolve;
                            testScript.onerror = reject;
                            document.head.appendChild(testScript);
                        };
                        jsScript.onerror = reject;
                        document.head.appendChild(jsScript);
                    };
                    cssLink.onerror = reject;
                    document.head.appendChild(cssLink);
                });
            }

            showLoading() {
                document.getElementById('loadingIndicator').style.display = 'block';
                document.getElementById('testResults').style.display = 'none';
                document.getElementById('runTestBtn').disabled = true;
            }

            hideLoading() {
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('runTestBtn').disabled = false;
            }

            showError(message) {
                this.hideLoading();
                const resultsDiv = document.getElementById('testResults');
                resultsDiv.innerHTML = `
                    <div class="error-list">
                        <h3>Error</h3>
                        <div class="error-item">${message}</div>
                    </div>
                `;
                resultsDiv.style.display = 'block';
            }

            displayResults(report) {
                this.hideLoading();

                if (!report) {
                    this.showError('No test results available');
                    return;
                }

                const resultsDiv = document.getElementById('testResults');
                resultsDiv.innerHTML = this.generateResultsHTML(report);
                resultsDiv.style.display = 'block';
            }

            generateResultsHTML(report) {
                const { summary, browser, device, details } = report;

                return `
                    <div class="score-display">
                        <h2>Overall Compatibility Score</h2>
                        <div class="score-number">${summary.overallScore}%</div>
                        <p>${summary.passedTests}/${summary.totalTests} tests passed</p>
                    </div>
                    
                    <div class="browser-info">
                        <h3>Browser & Device Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Browser:</span>
                                <span>${browser.name} ${browser.version}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Device Type:</span>
                                <span>${device.type}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Touch Support:</span>
                                <span>${device.touchSupport ? 'Yes' : 'No'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Screen Size:</span>
                                <span>${device.screenSize}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Viewport:</span>
                                <span>${device.viewportSize}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="test-section">
                        <h2>Core Features</h2>
                        <div class="test-grid">
                            ${this.generateFeatureTests(details.features)}
                        </div>
                    </div>
                    
                    <div class="test-section">
                        <h2>Animations</h2>
                        <div class="test-grid">
                            ${this.generateFeatureTests(details.animations)}
                        </div>
                    </div>
                    
                    <div class="test-section">
                        <h2>Interactions</h2>
                        <div class="test-grid">
                            ${this.generateFeatureTests(details.interactions)}
                        </div>
                    </div>
                    
                    <div class="test-section">
                        <h2>Performance</h2>
                        <div class="test-grid">
                            ${this.generatePerformanceTests(details.performance)}
                        </div>
                    </div>
                    
                    ${details.mobileFeatures ? `
                        <div class="test-section">
                            <h2>Mobile Features</h2>
                            <div class="test-grid">
                                ${this.generateFeatureTests(details.mobileFeatures)}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${details.errors && details.errors.length > 0 ? `
                        <div class="test-section">
                            <h2>Errors & Issues</h2>
                            <div class="error-list">
                                ${details.errors.map(error => `<div class="error-item">${error}</div>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                `;
            }

            generateFeatureTests(features) {
                return Object.entries(features).map(([key, value]) => {
                    const status = value === true ? 'pass' : (value === false ? 'fail' : 'warning');
                    const statusText = value === true ? 'Pass' : (value === false ? 'Fail' : 'Warning');

                    return `
                        <div class="test-card">
                            <h3>${this.formatTestName(key)}</h3>
                            <div class="test-result">
                                <span class="status-icon status-${status}"></span>
                                <span>${statusText}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            generatePerformanceTests(performance) {
                return Object.entries(performance).map(([key, value]) => {
                    let status = 'warning';
                    let statusText = 'Unknown';
                    let details = '';

                    if (typeof value === 'object') {
                        if (value.error) {
                            status = 'fail';
                            statusText = 'Error';
                            details = value.error;
                        } else if (value.acceptable !== undefined) {
                            status = value.acceptable ? 'pass' : 'fail';
                            statusText = value.acceptable ? 'Good' : 'Poor';

                            // Add specific details based on test type
                            if (key === 'loadTime') {
                                details = `${value.total}ms total, ${value.domReady}ms DOM ready`;
                            } else if (key === 'animationFrameRate') {
                                details = `${value.fps} FPS`;
                            } else if (key === 'memoryUsage') {
                                details = `${value.used}MB used / ${value.total}MB total`;
                            } else if (key === 'renderingPerformance') {
                                details = `${value.renderTime.toFixed(2)}ms render time`;
                            }
                        }
                    }

                    return `
                        <div class="test-card">
                            <h3>${this.formatTestName(key)}</h3>
                            <div class="test-result">
                                <span class="status-icon status-${status}"></span>
                                <span>${statusText}</span>
                            </div>
                            ${details ? `<div style="font-size: 12px; color: #666; margin-top: 5px;">${details}</div>` : ''}
                        </div>
                    `;
                }).join('');
            }

            formatTestName(name) {
                return name
                    .replace(/([A-Z])/g, ' $1')
                    .replace(/^./, str => str.toUpperCase())
                    .trim();
            }
        }

        // Initialize the test UI
        document.addEventListener('DOMContentLoaded', () => {
            new CrossBrowserTestUI();
        });

        // Minimal CrossBrowserValidator for standalone testing
        class CrossBrowserValidator {
            constructor() {
                this.testResults = {
                    browser: this.detectBrowser(),
                    device: this.detectDevice(),
                    features: {},
                    animations: {},
                    interactions: {},
                    performance: {},
                    errors: []
                };

                this.runBasicTests();
            }

            detectBrowser() {
                const userAgent = navigator.userAgent;

                if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
                    return { name: 'Chrome', version: this.extractVersion(userAgent, 'Chrome/') };
                } else if (userAgent.includes('Firefox')) {
                    return { name: 'Firefox', version: this.extractVersion(userAgent, 'Firefox/') };
                } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
                    return { name: 'Safari', version: this.extractVersion(userAgent, 'Version/') };
                } else if (userAgent.includes('Edg')) {
                    return { name: 'Edge', version: this.extractVersion(userAgent, 'Edg/') };
                } else {
                    return { name: 'Unknown', version: 'Unknown' };
                }
            }

            detectDevice() {
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const isTablet = /iPad|Android(?=.*Mobile)/i.test(navigator.userAgent);

                return {
                    type: isMobile ? (isTablet ? 'tablet' : 'mobile') : 'desktop',
                    touchSupport: 'ontouchstart' in window,
                    screenSize: `${window.screen.width}x${window.screen.height}`,
                    viewportSize: `${window.innerWidth}x${window.innerHeight}`
                };
            }

            extractVersion(userAgent, prefix) {
                const start = userAgent.indexOf(prefix) + prefix.length;
                const end = userAgent.indexOf(' ', start);
                return userAgent.substring(start, end === -1 ? undefined : end);
            }

            runBasicTests() {
                // Basic feature detection
                this.testResults.features = {
                    cssCustomProperties: CSS.supports('color', 'var(--test)'),
                    cssGrid: CSS.supports('display', 'grid'),
                    flexbox: CSS.supports('display', 'flex'),
                    transforms: CSS.supports('transform', 'translateX(10px)'),
                    animations: CSS.supports('animation', 'test 1s ease'),
                    intersectionObserver: typeof IntersectionObserver !== 'undefined',
                    resizeObserver: typeof ResizeObserver !== 'undefined',
                    requestAnimationFrame: typeof requestAnimationFrame !== 'undefined',
                    localStorage: this.testLocalStorage(),
                    eventListeners: true
                };

                // Basic animation tests
                this.testResults.animations = {
                    fadeInUp: true, // Assume supported if CSS animations work
                    slideInLeft: true,
                    haloAnimations: false, // Not available in standalone mode
                    reducedMotion: typeof window.matchMedia !== 'undefined'
                };

                // Basic interaction tests
                this.testResults.interactions = {
                    mouseEvents: true,
                    keyboardEvents: true,
                    touchEvents: this.testResults.device.touchSupport,
                    focusManagement: true,
                    navigationInteractions: false // Not available in standalone mode
                };

                // Basic performance tests
                this.testResults.performance = {
                    loadTime: this.measureLoadTime(),
                    animationFrameRate: { fps: 60, acceptable: true }, // Assume good
                    memoryUsage: this.testMemoryUsage(),
                    renderingPerformance: { renderTime: 10, acceptable: true }
                };

                // Generate report
                const report = {
                    timestamp: new Date().toISOString(),
                    browser: this.testResults.browser,
                    device: this.testResults.device,
                    summary: {
                        totalTests: this.countTotalTests(),
                        passedTests: this.countPassedTests(),
                        failedTests: this.testResults.errors.length,
                        overallScore: this.calculateOverallScore()
                    },
                    details: this.testResults
                };

                window.crossBrowserReport = report;
            }

            testLocalStorage() {
                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    return true;
                } catch (e) {
                    return false;
                }
            }

            measureLoadTime() {
                try {
                    if (window.performance && window.performance.timing) {
                        const timing = window.performance.timing;
                        const loadTime = timing.loadEventEnd - timing.navigationStart;
                        return {
                            total: loadTime,
                            domReady: timing.domContentLoadedEventEnd - timing.navigationStart,
                            acceptable: loadTime < 3000
                        };
                    }
                    return { error: 'Performance timing not available' };
                } catch (e) {
                    return { error: e.message };
                }
            }

            testMemoryUsage() {
                try {
                    if (window.performance && window.performance.memory) {
                        const memory = window.performance.memory;
                        return {
                            used: Math.round(memory.usedJSHeapSize / 1024 / 1024),
                            total: Math.round(memory.totalJSHeapSize / 1024 / 1024),
                            limit: Math.round(memory.jsHeapSizeLimit / 1024 / 1024),
                            acceptable: memory.usedJSHeapSize < (memory.jsHeapSizeLimit * 0.8)
                        };
                    }
                    return { error: 'Memory API not available' };
                } catch (e) {
                    return { error: e.message };
                }
            }

            countTotalTests() {
                return Object.keys(this.testResults.features).length +
                    Object.keys(this.testResults.animations).length +
                    Object.keys(this.testResults.interactions).length +
                    Object.keys(this.testResults.performance).length;
            }

            countPassedTests() {
                let passed = 0;

                Object.values(this.testResults.features).forEach(result => {
                    if (result === true) passed++;
                });

                Object.values(this.testResults.animations).forEach(result => {
                    if (result === true) passed++;
                });

                Object.values(this.testResults.interactions).forEach(result => {
                    if (result === true) passed++;
                });

                Object.values(this.testResults.performance).forEach(result => {
                    if (typeof result === 'object' && result.acceptable === true) passed++;
                });

                return passed;
            }

            calculateOverallScore() {
                const total = this.countTotalTests();
                const passed = this.countPassedTests();

                if (total === 0) return 0;

                return Math.round((passed / total) * 100);
            }
        }
    </script>
</body>

</html>